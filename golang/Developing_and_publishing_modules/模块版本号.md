## 模块版本号

模块开发者使用模块版本数字的每一部分来表示版本稳定性及向后兼容性。对每一个新的发布，模块的发布版本号特别反映了自上次发布以来的模块修改的种类。

当你在开发使用外部模块的代码时，在你考虑升级时你可以使用版本号来理解外部模块的稳定性。当你在开发自己的模块时，你的版本号将向其他开发者表示你的模块的稳定性和向后兼容性。

本文描述模块版本数字意味着什么。

请参见：

- 当你在你的代码中使用外部包，你能够利用 Go 工具来管理这些依赖。更多信息，请参见[管理依赖](https://go.dev/doc/modules/managing-dependencies)
- 如果你在开发一个供他人使用的模块，当你发布模块时，你在仓库在为你的模块打上标签，并形成模块版本号。更多信息，请参见[发布一个模块](https://go.dev/doc/modules/publishing)。

一个发布的模块带一个版本号发布，他遵循语义版本模型，如下所示：

![版本号](images/version-number.png)

下表描述了一个版本号的不同部分如何表示一个模块的稳定性及向后兼容性：

版本阶段|示例|向开发者传达的信息
-------|--------|--------
[开发中](https://go.dev/doc/modules/version-numbers#in-development)|自动伪版本号 v**0**.x.x|表示模块仍**处于开发阶段且不稳定**。该发布不带有任何稳定性和兼容性保证
[主版本](https://go.dev/doc/modules/version-numbers#major)|v**1**.x.x|表示**不兼容的公共 API 修改**。该发布可能带有与之前主版本不兼容的修改
[次版本](https://go.dev/doc/modules/version-numbers#minor)|vx.**4**.x|表示**后向兼容的公共 API 修改**。该发布保证后向兼容性及稳定性。
[补丁版本](https://go.dev/doc/modules/version-numbers#patch)|vx.x.**1**|表示修改**不影响公共 API**及其依赖。该发布保证后向兼容性及稳定性。
[预发布版本](https://go.dev/doc/modules/version-numbers#pre-release)|vx.x.x-**beta.2**|表示这是一个**预发布里程碑，例如一个 alpha 或 beta**。模块仍处于开发阶段且不稳定。该发布不保证稳定性。

### 1. 开发中

表示模块仍处于开发阶段且不稳定。该发布不带有任何稳定性和兼容性保证。

版本号可以采用如下格式：

- **伪版本号**

```
v0.0.0-20170915032832-14c0d48ead0c
```

- **v0 number**

```
v0.x.x
```

#### 1.1 伪版本号

如果一个模块还未在仓库里打标签，Go 工具将在 `go.mod` 文件里产生一个伪版本号以备调用方使用。

> 作为最佳实践，总是允许 Go 工具 产生伪版本号而不是你自己创建。

当一个你的模块使用者需要使用一个你的特定提交二该提交还未被打标签时，伪版本号是有用的。

伪版本号以横杠分割为三个部分：

- 语法
  
  ```
  baseVersionPrefix-timestamp-revisionIdentifier
  ```

- 组成
  
  + **baseVersionPrefix (vX.0.0 or vX.Y.Z-0)** 版本之前衍生自语义版本标签的一个值；如果没有此语义标签则为 vX.0.0。
  + **timestamp (yymmddhhmmss)** 版本创建的 UTC 时间戳。在 Git 中，他为提交时间而非修改时间。
  + **revisionIdentifier (abcdefabcdef)**：12 个字符的提交哈希，或者在 `Subversion` 中为填充 0 的版本号。

#### 1.2 v0 版本

一个模块如果以 `v0` 版本号发布，则就带有与主要版本，次版本，补丁版本，以及可选的预发布识别号一致的语义版本号。

虽然一个 `v0` 版本可以用于产品环境，但其稳定性及后向兼容性无法保证。另外，版本 `v1` 允许打破与 `v0` 版本的兼容性。基于这个原因，开发者有责任在 `v1` 发布时修改客户端与 `v0` 不兼容的客户端调用。

### 2. 预发布版本

表示这是一个预发阶段成果，例如一个 `alpha` 或 `beta`。该发布不具稳定性保证。

**示例**：

```
  vx.x.x-beta.2
```

模块开发者可以使用 `major.minor.patch` 组合加 `-` 以及预发布标识符来作为预发布版本号。

### 3. 次版本

表示模块公开 API 的兼容性修改。这个发布保证向兼容性与稳定性。 

**示例**：

```
vx.4.x
```

这个版本修改了模块的公开 API，但并不打破之前的调用代码。他可能包括模块的自身依赖的修改，新的函数，方法，结构体字段以及类型的加入等。

换句话说，这个版本可能包括例如引入其他开发者期待的新函数之类的增强。但是，使用之前此版本的开发者并不需要因此改变代码。

### 4. 补丁版本

表示模块公开 API 及其依赖并未改变。 这个发布保证向兼容性与稳定性。 

**示例**：

```
vx.x.1
```

版本号数字的增加仅仅意味着很小的修改，例如缺陷修正。客户端代码开发者可以安全地升级到这个版本而不需要修改代码。

### 5. 主版本

表示模块公开 API 的不兼容修改。这个发布不保证与之前主版本的后向兼容性。

**示例**：

```
v1.x.x
```

一个 v1 或上面的版本号指示模块是稳定可用的（除非是与发布版本）。

注意由于版本 0 不保证稳定性和后向兼容性，将模块从 v0 升级至 v1 的开发者有责任适配打破兼容性的修改。

v1 之后模块开发者应该谨慎增加版本号，原因在于版本升级对于模块客户意味着重大中断。这个中断包括公开 API 的不兼容修改，以及对模块路径的修改等。

一个主版本号升级到高于 v1 也带有一个新的模块路径。这是由于模块路径带有主版本号，如下所示：

```
module example.com/mymodule/v2 v2.0.0
```

一个主版本升级使得这个模块拥有了一个不同于模块之前版本的历史。如果你在开发模块发布给他人，请参考[模块发布及版本演化工作流](https://go.dev/doc/modules/release-workflow)中的“发布 API 破坏性修改”。

更多模块指令，请参见 [go.mod 参考](https://go.dev/doc/modules/gomod-ref)。

### Reference

- [模块版本号](https://go.dev/doc/modules/version-numbers)
