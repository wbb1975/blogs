## 处理瞬态错误的建议

本指南描述了在你的云应用中处理瞬态错误的建议，所有与远程服务和资源通讯的程序必须对瞬态错误敏感。这一点对于运行于云上的应用尤其重要--由于环境及通过 internet 连接的本性，这种类型的错误遇见得更频繁一些。瞬态错误包括至组件和服务的网络连接的短暂丢失，服务暂时不可用，以及服务繁忙时的超时。这些错误是自纠正的，因此在一个合适的延迟后，采取某种行动是可能成功的。

本文提供瞬态错误处理的通用指南。关于在你的应用中为处理瞬态错误而实现重试的信息，请参见[重试模式](https://learn.microsoft.com/en-us/azure/architecture/patterns/retry)，当你使用Azure 服务时，请参见[Azure 服务重试指南](https://learn.microsoft.com/en-us/azure/architecture/best-practices/retry-service-specific)。

## 处理瞬态错误

瞬态错误可以在任何环境，任何平台或操作系统，任何种类的应用中发生。对于运行于本地 on-premises 基础设施上的方案，应用和组件的性能和可用性典型第通过昂贵且低使用率的硬件冗余来保证，并且组件和资源相互离得很近。这种方式使得错误发生的概率降低，但瞬态错误仍会出现，就像由不可预测事件如外部电力中断，网络问题或者灾难场景导致的服务中断。

云托管，如私有云系统，通过使用共享资源，冗余，自动故障转移，以及跨多个商用计算节点的动态资源分配来提供更高的综合可用性。但是，由于云环境的本性，瞬态错误更有可能发生。一下原因可以解释这个现象：

- 在云环境中许多资源是共享的，对这些资源的访问是被节流的以保护这些资源。当负载达到一个特定级别，或者最大吞吐量达到时，某些服务会拒绝连接以允许已有请求的处理，以及维护该服务对所有用户的性能。节流帮忙维护对邻居以及使用共享服务的其它租户的服务质量。
- 云环境使用了大量的商用硬件单元，它们通过跨多个计算单元和基础设施组件动态分配负载来实现性能指标。他们通过自动回收或替换失效单元来实现可靠性。由于这种动态本性，瞬态错误或暂时连接失败可能会偶尔发生。
- 通常有很多硬件组件，抱愧网络基础设施如路由器和负载均衡器，它们位于应用和应用使用的服务和资源之间。这些额外的基础设施偶尔也可能引入额外的连接延时和瞬态连接错误。
- 客户端与服务器端的网路i状况可能是变化的，尤其是跨 internet 通讯。即使是在 on-premises 场景，重负载也会拖慢通讯并导致间歇性连接失败。

瞬态错误对应用的观察到的可用性又重大影响，即使它已经在一个稳定的环境里充分测试过。为了确保云托管应用可靠地运作，你需要确保它们对下面的挑战做出了适当的反应：

- 当错误发生时，应用必须能检测到它们并判断错误是暂时的，是持续很长时间的还是终端故障。当错误发生时，不同资源可能返回不同的反应，这些反应可能会根据不同运作背景而不同。例如，一个应用在读存储发生错误的反应绝对不同于写存储。许多资源和服务对于瞬态错误都有很好的文档。但是，当此类信息不可得时，你就很难揭示错误的本质，并判断错误是否是暂时的。
- 应用如果能够判断错误可能是临时的，那么他就必须重试操作。它必须追踪操作充实的次数。
- 应用必须为重试采用一个合适的策略。策略制定了应用重试的次数，每次重试的时间间隔，以及每次重试失败后采取的措施。合适的重试次数以及间隔是很难确定的。策略可依据资源类型，资源的当前操作条件，以及应用二改变。

下面的指南可帮助你为你的应用设计合适的瞬态错误处理机制。

## 重试实现

## Reference
- [Recommendations for handling transient faults](https://learn.microsoft.com/en-us/azure/well-architected/design-guides/handle-transient-faults)