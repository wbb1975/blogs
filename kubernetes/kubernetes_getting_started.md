# å…¥é—¨
æœ¬èŠ‚ä»‹ç»äº†è®¾ç½®å’Œè¿è¡Œ Kubernetes ç¯å¢ƒçš„ä¸åŒé€‰é¡¹ã€‚

ä¸åŒçš„ Kubernetes è§£å†³æ–¹æ¡ˆæ»¡è¶³ä¸åŒçš„è¦æ±‚ï¼šæ˜“äºç»´æŠ¤ã€å®‰å…¨æ€§ã€å¯æ§åˆ¶æ€§ã€å¯ç”¨èµ„æºä»¥åŠæ“ä½œå’Œç®¡ç† Kubernetes é›†ç¾¤æ‰€éœ€çš„ä¸“ä¸šçŸ¥è¯†ã€‚

å¯ä»¥åœ¨æœ¬åœ°æœºå™¨ã€äº‘ã€æœ¬åœ°æ•°æ®ä¸­å¿ƒä¸Šéƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œæˆ–é€‰æ‹©ä¸€ä¸ªæ‰˜ç®¡çš„ Kubernetes é›†ç¾¤ã€‚è¿˜å¯ä»¥è·¨å„ç§äº‘æä¾›å•†æˆ–è£¸æœºç¯å¢ƒåˆ›å»ºè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆã€‚

æ›´ç®€å•åœ°è¯´ï¼Œå¯ä»¥åœ¨å­¦ä¹ å’Œç”Ÿäº§ç¯å¢ƒä¸­åˆ›å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ã€‚

**å­¦ä¹ ç¯å¢ƒ**

å¦‚æœæ­£æ‰“ç®—å­¦ä¹  Kubernetesï¼Œè¯·ä½¿ç”¨åŸºäº Docker çš„è§£å†³æ–¹æ¡ˆï¼šDocker æ˜¯ Kubernetes ç¤¾åŒºæ”¯æŒæˆ–ç”Ÿæ€ç³»ç»Ÿä¸­ç”¨æ¥åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè®¾ç½® Kubernetes é›†ç¾¤çš„ä¸€ç§å·¥å…·ã€‚

**ç”Ÿäº§ç¯å¢ƒ**

åœ¨è¯„ä¼°ç”Ÿäº§ç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œè¯·è€ƒè™‘è¦ç®¡ç†è‡ªå·± Kubernetes é›†ç¾¤ï¼ˆæŠ½è±¡å±‚é¢ï¼‰çš„å“ªäº›æ–¹é¢æˆ–å°†å…¶è½¬ç§»ç»™æä¾›å•†ã€‚

[Kubernetes åˆä½œä¼™ä¼´](https://kubernetes.io/partners/#conformance)åŒ…æ‹¬ä¸€ä¸ª[å·²è®¤è¯çš„ Kubernetes](https://github.com/cncf/k8s-conformance/#certified-kubernetes)æä¾›å•†åˆ—è¡¨ã€‚
## 1. Kubernetes å‘è¡Œè¯´æ˜å’Œç‰ˆæœ¬åå·®
### 1.1 v1.18 å‘å¸ƒè¯´æ˜
#### v1.18.0
[æ–‡æ¡£](https://docs.k8s.io/)
#### Downloads for v1.18.0
filename|sha512 hash
--------|--------
[kubernetes.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes.tar.gz)|cd5b86a3947a4f2cea6d857743ab2009be127d782b6f2eb4d37d88918a5e433ad2c7ba34221c34089ba5ba13701f58b657f0711401e51c86f4007cb78744dee7
[kubernetes-src.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-src.tar.gz)|fb42cf133355ef18f67c8c4bb555aa1f284906c06e21fa41646e086d34ece774e9d547773f201799c0c703ce48d4d0e62c6ba5b2a4d081e12a339a423e111e52
##### Client Binaries
filename|sha512 hash
--------|--------
[kubernetes-client-darwin-386.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-darwin-386.tar.gz)|26df342ef65745df12fa52931358e7f744111b6fe1e0bddb8c3c6598faf73af997c00c8f9c509efcd7cd7e82a0341a718c08fbd96044bfb58e80d997a6ebd3c2
[kubernetes-client-darwin-amd64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-darwin-amd64.tar.gz)|803a0fed122ef6b85f7a120b5485723eaade765b7bc8306d0c0da03bd3df15d800699d15ea2270bb7797fa9ce6a81da90e730dc793ea4ed8c0149b63d26eca30
[kubernetes-client-linux-386.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-linux-386.tar.gz)|110844511b70f9f3ebb92c15105e6680a05a562cd83f79ce2d2e25c2dd70f0dbd91cae34433f61364ae1ce4bd573b635f2f632d52de8f72b54acdbc95a15e3f0
[kubernetes-client-linux-amd64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-linux-amd64.tar.gz)|594ca3eadc7974ec4d9e4168453e36ca434812167ef8359086cd64d048df525b7bd46424e7cc9c41e65c72bda3117326ba1662d1c9d739567f10f5684fd85bee
[kubernetes-client-linux-arm.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-linux-arm.tar.gz)|d3627b763606557a6c9a5766c34198ec00b3a3cd72a55bc2cb47731060d31c4af93543fb53f53791062bb5ace2f15cbaa8592ac29009641e41bd656b0983a079
[kubernetes-client-linux-arm64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-linux-arm64.tar.gz)|ba9056eff1452cbdaef699efbf88f74f5309b3f7808d372ebf6918442d0c9fea1653c00b9db3b7626399a460eef9b1fa9e29b827b7784f34561cbc380554e2ea
[kubernetes-client-linux-ppc64le.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-linux-ppc64le.tar.gz)|f80fb3769358cb20820ff1a1ce9994de5ed194aabe6c73fb8b8048bffc394d1b926de82c204f0e565d53ffe7562faa87778e97a3ccaaaf770034a992015e3a86
[kubernetes-client-linux-s390x.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-linux-s390x.tar.gz)|a9b658108b6803d60fa3cd4e76d9e58bf75201017164fe54054b7ccadbb68c4ad7ba7800746940bc518d90475e6c0a96965a26fa50882f4f0e56df404f4ae586
[kubernetes-client-windows-386.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-windows-386.tar.gz)|18adffab5d1be146906fd8531f4eae7153576aac235150ce2da05aee5ae161f6bd527e8dec34ae6131396cd4b3771e0d54ce770c065244ad3175a1afa63c89e1
[kubernetes-client-windows-amd64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-client-windows-amd64.tar.gz)|162396256429cef07154f817de2a6b67635c770311f414e38b1e2db25961443f05d7b8eb1f8da46dec8e31c5d1d2cd45f0c95dad1bc0e12a0a7278a62a0b9a6b
##### Server Binaries
filename|sha512 hash
--------|--------
[kubernetes-server-linux-amd64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-server-linux-amd64.tar.gz)|a92f8d201973d5dfa44a398e95fcf6a7b4feeb1ef879ab3fee1c54370e21f59f725f27a9c09ace8c42c96ac202e297fd458e486c489e05f127a5cade53b8d7c4
[kubernetes-server-linux-arm.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-server-linux-arm.tar.gz)|62fbff3256bc0a83f70244b09149a8d7870d19c2c4b6dee8ca2714fc7388da340876a0f540d2ae9bbd8b81fdedaf4b692c72d2840674db632ba2431d1df1a37d
[kubernetes-server-linux-arm64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-server-linux-arm64.tar.gz)|842910a7013f61a60d670079716b207705750d55a9e4f1f93696d19d39e191644488170ac94d8740f8e3aa3f7f28f61a4347f69d7e93d149c69ac0efcf3688fe
[kubernetes-server-linux-ppc64le.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-server-linux-ppc64le.tar.gz)|95c5b952ac1c4127a5c3b519b664972ee1fb5e8e902551ce71c04e26ad44b39da727909e025614ac1158c258dc60f504b9a354c5ab7583c2ad769717b30b3836
[kubernetes-server-linux-s390x.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-server-linux-s390x.tar.gz)|a46522d2119a0fd58074564c1fa95dd8a929a79006b82ba3c4245611da8d2db9fd785c482e1b61a9aa361c5c9a6d73387b0e15e6a7a3d84fffb3f65db3b9deeb
##### Node Binaries
filename|sha512 hash
--------|--------
[kubernetes-node-linux-amd64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-node-linux-amd64.tar.gz)|f714f80feecb0756410f27efb4cf4a1b5232be0444fbecec9f25cb85a7ccccdcb5be588cddee935294f460046c0726b90f7acc52b20eeb0c46a7200cf10e351a
[kubernetes-node-linux-arm.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-node-linux-arm.tar.gz)|806000b5f6d723e24e2f12d19d1b9b3d16c74b855f51c7063284adf1fcc57a96554a3384f8c05a952c6f6b929a05ed12b69151b1e620c958f74c9600f3db0fcb
[kubernetes-node-linux-arm64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-node-linux-arm64.tar.gz)|c207e9ab60587d135897b5366af79efe9d2833f33401e469b2a4e0d74ecd2cf6bb7d1e5bc18d80737acbe37555707f63dd581ccc6304091c1d98dafdd30130b7
[kubernetes-node-linux-ppc64le.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-node-linux-ppc64le.tar.gz)|a542ed5ed02722af44ef12d1602f363fcd4e93cf704da2ea5d99446382485679626835a40ae2ba47a4a26dce87089516faa54479a1cfdee2229e8e35aa1c17d7
[kubernetes-node-linux-s390x.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-node-linux-s390x.tar.gz)|651e0db73ee67869b2ae93cb0574168e4bd7918290fc5662a6b12b708fa628282e3f64be2b816690f5a2d0f4ff8078570f8187e65dee499a876580a7a63d1d19
[kubernetes-node-windows-amd64.tar.gz](https://dl.k8s.io/v1.18.0/kubernetes-node-windows-amd64.tar.gz)|d726ed904f9f7fe7e8831df621dc9094b87e767410a129aa675ee08417b662ddec314e165f29ecb777110fbfec0dc2893962b6c71950897ba72baaa7eb6371ed
#### Changelog since v1.17.0
A complete changelog for the release notes is now hosted in a customizable format at https://relnotes.k8s.io. Check it out and please give us your feedback!
#### Whatâ€™s New (Major Themes) 
### 1.2 Kubernetes ç‰ˆæœ¬åŠç‰ˆæœ¬å€¾æ–œæ”¯æŒç­–ç•¥
æœ¬æ–‡æè¿° Kubernetes å„ç»„ä»¶ä¹‹é—´ç‰ˆæœ¬å€¾æ–œæ”¯æŒç­–ç•¥ã€‚ ç‰¹å®šçš„é›†ç¾¤éƒ¨ç½²å·¥å…·å¯èƒ½ä¼šæœ‰é¢å¤–çš„é™åˆ¶ã€‚
#### 1.2.1 ç‰ˆæœ¬æ”¯æŒç­–ç•¥
Kubernetes ç‰ˆæœ¬å·æ ¼å¼ä¸º x.y.zï¼Œå…¶ä¸­ x ä¸ºå¤§ç‰ˆæœ¬å·ï¼Œy ä¸ºå°ç‰ˆæœ¬å·ï¼Œz ä¸ºè¡¥ä¸ç‰ˆæœ¬å·ã€‚ ç‰ˆæœ¬å·æ ¼å¼éµå¾ª [Semantic Versioning](http://semver.org/) è§„åˆ™ã€‚ æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [Kubernetes Release Versioning](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/release/versioning.md#kubernetes-release-versioning)ã€‚

Kubernetes é¡¹ç›®ä¼šç»´æŠ¤æœ€è¿‘çš„ä¸‰ä¸ªå°ç‰ˆæœ¬åˆ†æ”¯ã€‚

ä¸€äº› bug ä¿®å¤ï¼ŒåŒ…æ‹¬å®‰å…¨ä¿®å¤ï¼Œæ ¹æ®å…¶å®‰å…¨æ€§å’Œå¯ç”¨æ€§ï¼Œæœ‰å¯èƒ½ä¼šå›åˆåˆ°è¿™äº›åˆ†æ”¯ã€‚ è¡¥ä¸ç‰ˆæœ¬ä¼šå®šæœŸæˆ–æ ¹æ®éœ€è¦ä»è¿™äº›åˆ†æ”¯ä¸­å‘å¸ƒã€‚ æœ€ç»ˆæ˜¯å¦å‘å¸ƒæ˜¯ç”±[patch release team](https://github.com/kubernetes/sig-release/blob/master/release-engineering/role-handbooks/patch-release-manager.md#release-timing)æ¥å†³å®šçš„ã€‚Patch release teamåŒæ—¶ä¹Ÿæ˜¯[release managers](https://github.com/kubernetes/sig-release/blob/master/release-managers.md). å¦‚éœ€äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[Kubernetes Patch releases](https://github.com/kubernetes/sig-release/blob/master/releases/patch-releases.md).

å°ç‰ˆæœ¬å¤§çº¦æ¯3ä¸ªæœˆå‘å¸ƒä¸€ä¸ªï¼Œæ‰€ä»¥æ¯ä¸ªå°ç‰ˆæœ¬åˆ†æ”¯ä¼šç»´æŠ¤9ä¸ªæœˆã€‚
#### 1.2.2 ç‰ˆæœ¬å€¾æ–œç­–ç•¥
##### kube-apiserver
åœ¨[é«˜å¯ç”¨ï¼ˆHAï¼‰é›†ç¾¤](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/)ä¸­ï¼Œ å¤šä¸ª kube-apiserver å®ä¾‹å°ç‰ˆæœ¬å·æœ€å¤šå·®1ã€‚

ä¾‹å¦‚ï¼š
- æœ€æ–°çš„ kube-apiserver ç‰ˆæœ¬å·å¦‚æœæ˜¯ 1.13
- å…¶ä»– kube-apiserver ç‰ˆæœ¬å·åªèƒ½æ˜¯ 1.13 æˆ– 1.12
##### kubelet
kubelet ç‰ˆæœ¬å·ä¸èƒ½é«˜äº kube-apiserverï¼Œæœ€å¤šå¯ä»¥æ¯” kube-apiserver ä½ä¸¤ä¸ªå°ç‰ˆæœ¬ã€‚

ä¾‹å¦‚ï¼š
- kube-apiserver ç‰ˆæœ¬å·å¦‚æœæ˜¯ 1.13
- kubelet åªèƒ½æ˜¯ 1.13 ã€ 1.12 å’Œ 1.11

> **è¯´æ˜**ï¼š å¦‚æœHAé›†ç¾¤ä¸­å¤šä¸ª kube-apiserver å®ä¾‹ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œç›¸åº”çš„ kubelet ç‰ˆæœ¬å·å¯é€‰èŒƒå›´ä¹Ÿè¦å‡å°ã€‚

ä¾‹å¦‚ï¼š
- å¦‚æœ kube-apiserver çš„å¤šä¸ªå®ä¾‹åŒæ—¶å­˜åœ¨ 1.13 å’Œ 1.12
- kubelet åªèƒ½æ˜¯ 1.12 æˆ– 1.11ï¼ˆ1.13 ä¸å†æ”¯æŒï¼Œå› ä¸ºå®ƒæ¯”1.12ç‰ˆæœ¬çš„ kube-apiserver æ›´æ–°ï¼‰
##### kube-controller-managerã€ kube-scheduler å’Œ cloud-controller-manager
kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager ç‰ˆæœ¬ä¸èƒ½é«˜äº kube-apiserver ç‰ˆæœ¬å·ã€‚ æœ€å¥½å®ƒä»¬çš„ç‰ˆæœ¬å·ä¸ kube-apiserver ä¿æŒä¸€è‡´ï¼Œä½†å…è®¸æ¯” kube-apiserver ä½ä¸€ä¸ªå°ç‰ˆæœ¬ï¼ˆä¸ºäº†æ”¯æŒåœ¨çº¿å‡çº§ï¼‰ã€‚

ä¾‹å¦‚ï¼š
- å¦‚æœ kube-apiserver ç‰ˆæœ¬å·ä¸º 1.13
- kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager ç‰ˆæœ¬æ”¯æŒ 1.13 å’Œ 1.12

> **è¯´æ˜**ï¼š å¦‚æœåœ¨ HA é›†ç¾¤ä¸­ï¼Œå¤šä¸ª `kube-apiserver` å®ä¾‹ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥è·Ÿä»»æ„ä¸€ä¸ª `kube-apiserver` å®ä¾‹é€šä¿¡ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ load balancerï¼‰ï¼Œ
ä½† kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager ç‰ˆæœ¬å¯ç”¨èŒƒå›´ä¼šç›¸åº”çš„å‡å°ã€‚

ä¾‹å¦‚ï¼š
- kube-apiserver å®ä¾‹åŒæ—¶å­˜åœ¨ 1.13 å’Œ 1.12 ç‰ˆæœ¬
- kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager å¯ä»¥é€šè¿‡ load balancer ä¸æ‰€æœ‰çš„ kube-apiserver é€šä¿¡
- kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager å¯é€‰ç‰ˆæœ¬ä¸º 1.12ï¼ˆ1.13 ä¸å†æ”¯æŒï¼Œå› ä¸ºå®ƒæ¯” 1.12 ç‰ˆæœ¬çš„ kube-apiserver æ›´æ–°ï¼‰
##### kubectl
kubectl å¯ä»¥æ¯” kube-apiserver é«˜ä¸€ä¸ªå°ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥ä½ä¸€ä¸ªå°ç‰ˆæœ¬ã€‚

ä¾‹å¦‚ï¼š
- å¦‚æœ kube-apiserver å½“å‰æ˜¯ 1.13 ç‰ˆæœ¬
- kubectl åˆ™æ”¯æŒ 1.14 ã€1.13 å’Œ 1.12

> **è¯´æ˜**ï¼šå¦‚æœ HA é›†ç¾¤ä¸­çš„å¤šä¸ª kube-apiserver å®ä¾‹ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œç›¸åº”çš„ kubectl å¯ç”¨ç‰ˆæœ¬èŒƒå›´ä¹Ÿä¼šå‡å°ã€‚

ä¾‹å¦‚ï¼š
- kube-apiserver å¤šä¸ªå®ä¾‹åŒæ—¶å­˜åœ¨ 1.13 å’Œ 1.12
- kubectl å¯é€‰çš„ç‰ˆæœ¬ä¸º 1.13 å’Œ 1.12ï¼ˆå…¶ä»–ç‰ˆæœ¬ä¸å†æ”¯æŒï¼Œå› ä¸ºå®ƒä¼šæ¯”å…¶ä¸­æŸä¸ª kube-apiserver å®ä¾‹é«˜æˆ–ä½ä¸€ä¸ªå°ç‰ˆæœ¬ï¼‰
#### 1.2.3 æ”¯æŒçš„ç»„ä»¶å‡çº§æ¬¡åº
ç»„ä»¶ä¹‹é—´æ”¯æŒçš„ç‰ˆæœ¬å€¾æ–œä¼šå½±å“ç»„ä»¶å‡çº§çš„é¡ºåºã€‚ æœ¬èŠ‚æè¿°ç»„ä»¶ä»ç‰ˆæœ¬ 1.n åˆ° 1.(n+1) çš„å‡çº§æ¬¡åºã€‚
##### kube-apiserver
å‰ææ¡ä»¶ï¼š
- å•å®ä¾‹é›†ç¾¤æ—¶ï¼Œkube-apiserver å®ä¾‹ç‰ˆæœ¬å·é¡»æ˜¯ 1.n
- HA é›†ç¾¤æ—¶ï¼Œæ‰€æœ‰çš„ kube-apiserver å®ä¾‹ç‰ˆæœ¬å·å¿…é¡»æ˜¯ 1.n æˆ– 1.(n+1)ï¼ˆç¡®ä¿æ»¡è¶³æœ€æ–°å’Œæœ€æ—§çš„å®ä¾‹å°ç‰ˆæœ¬å·ç›¸å·®ä¸å¤§äº1ï¼‰
- kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager ç‰ˆæœ¬å·å¿…é¡»ä¸º 1.nï¼ˆç¡®ä¿ä¸é«˜äº API server çš„ç‰ˆæœ¬ï¼Œä¸”ç‰ˆæœ¬å·ç›¸å·®ä¸å¤§äº1ï¼‰
- kubelet å®ä¾‹ç‰ˆæœ¬å·å¿…é¡»æ˜¯ 1.n æˆ– 1.(n-1)ï¼ˆç¡®ä¿ç‰ˆæœ¬å·ä¸é«˜äº API serverï¼Œä¸”ç‰ˆæœ¬å·ç›¸å·®ä¸å¤§äº2ï¼‰
- æ³¨å†Œçš„ admission æ’ä»¶å¿…é¡»èƒ½å¤Ÿå¤„ç†æ–°çš„ kube-apiserver å®ä¾‹å‘é€è¿‡æ¥çš„æ•°æ®ï¼š
  + ValidatingWebhookConfiguration å’Œ MutatingWebhookConfiguration å¯¹è±¡å¿…é¡»å‡çº§åˆ°å¯ä»¥å¤„ç† 1.(n+1) ç‰ˆæœ¬æ–°åŠ çš„ REST èµ„æº(æˆ–ä½¿ç”¨1.15ç‰ˆæœ¬æä¾›çš„ matchPolicy: Equivalent é€‰é¡¹)
  + æ’ä»¶å¯ä»¥å¤„ç†ä»»ä½• 1.(n+1) ç‰ˆæœ¬æ–°çš„ REST èµ„æºæ•°æ®å’Œæ–°åŠ çš„å­—æ®µ

å‡çº§ kube-apiserver åˆ° 1.(n+1)

> **è¯´æ˜**ï¼š è·Ÿæ® [API deprecation](/docs/reference/using-api/deprecation-policy/) å’Œ [API change guidelines](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api_changes.md) è§„åˆ™ï¼Œkube-apiserver ä¸èƒ½è·³è¿‡å°ç‰ˆæœ¬å·å‡çº§ï¼Œå³ä½¿æ˜¯å•å®ä¾‹é›†ç¾¤ä¹Ÿä¸å¯ä»¥ã€‚
##### kube-controller-managerã€ kube-scheduler å’Œ cloud-controller-manager
å‰ææ¡ä»¶ï¼š
- kube-apiserver å®ä¾‹å¿…é¡»ä¸º 1.(n+1) ï¼ˆHA é›†ç¾¤ä¸­ï¼Œæ‰€æœ‰çš„kube-apiserver å®ä¾‹å¿…é¡»åœ¨ç»„ä»¶å‡çº§å‰å®Œæˆå‡çº§ï¼‰

å‡çº§ kube-controller-managerã€kube-scheduler å’Œ cloud-controller-manager åˆ° 1.(n+1)
##### kubelet
å‰ææ¡ä»¶ï¼š
- kube-apiserver å®ä¾‹å¿…é¡»ä¸º 1.(n+1) ç‰ˆæœ¬

kubelet å¯ä»¥å‡çº§åˆ° 1.(n+1)ï¼ˆæˆ–è€…åœç•™åœ¨ 1.n æˆ– 1.(n-1)ï¼‰

> **è­¦å‘Š**ï¼š é›†ç¾¤ä¸­ `kubelet` ç‰ˆæœ¬å·ä¸å»ºè®®æ¯” `kube-apiserver` ä½ä¸¤ä¸ªç‰ˆæœ¬å·ï¼š
> - ä»–ä»¬å¿…é¡»å‡çº§åˆ°ä¸ kube-apiserver ç›¸å·®ä¸è¶…è¿‡1ä¸ªå°ç‰ˆæœ¬ï¼Œæ‰å¯ä»¥å‡çº§å…¶ä»–æ§åˆ¶é¢ç»„ä»¶
> - æœ‰å¯èƒ½ä½¿ç”¨ä½äº3ä¸ªåœ¨ç»´æŠ¤çš„å°ç‰ˆæœ¬
## 2. å­¦ä¹ ç¯å¢ƒ
### 2.1 ä½¿ç”¨ Minikube å®‰è£… Kubernetes
Minikube æ˜¯ä¸€ç§å¯ä»¥è®©ä½ åœ¨æœ¬åœ°è½»æ¾è¿è¡Œ Kubernetes çš„å·¥å…·ã€‚ Minikube åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„è™šæ‹Ÿæœºï¼ˆVMï¼‰ä¸­è¿è¡Œå•èŠ‚ç‚¹ Kubernetes é›†ç¾¤ï¼Œ ä¾›é‚£äº›å¸Œæœ›å°è¯• Kubernetes æˆ–è¿›è¡Œæ—¥å¸¸å¼€å‘çš„ç”¨æˆ·ä½¿ç”¨ã€‚
#### 2.1.1 Minikube åŠŸèƒ½
Minikube æ”¯æŒä»¥ä¸‹ Kubernetes åŠŸèƒ½ï¼š
- DNS
- NodePorts
- ConfigMaps å’Œ Secrets
- Dashboards
- å®¹å™¨è¿è¡Œæ—¶: Dockerã€[CRI-O](https://github.com/kubernetes-incubator/cri-o) ä»¥åŠ [containerd](https://github.com/containerd/containerd)
- å¯ç”¨ CNI ï¼ˆå®¹å™¨ç½‘ç»œæ¥å£ï¼‰
- Ingress
#### 2.1.2 å®‰è£…
è¯·å‚é˜…[å®‰è£… Minikube](https://kubernetes.io/zh/docs/tasks/tools/install-minikube/)
#### 2.1.3 å¿«é€Ÿå¼€å§‹
è¿™ä¸ªç®€çŸ­çš„æ¼”ç¤ºå°†æŒ‡å¯¼ä½ å¦‚ä½•åœ¨æœ¬åœ°å¯åŠ¨ã€ä½¿ç”¨å’Œåˆ é™¤ Minikubeã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¼€å§‹æ¢ç´¢ Minikubeã€‚
1. å¯åŠ¨ Minikube å¹¶åˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼š
   ```
   minikube start
   ```
   è¾“å‡ºç±»ä¼¼äºï¼š
   ```
   wangbb@devbox:~/git$ minikube start
   ğŸ˜„  Ubuntu 20.04 ä¸Šçš„ minikube v1.12.1
   âœ¨  æ ¹æ®ç°æœ‰çš„é…ç½®æ–‡ä»¶ä½¿ç”¨ docker é©±åŠ¨ç¨‹åº
   ğŸ‘  Starting control plane node minikube in cluster minikube
   ğŸ”„  Restarting existing docker container for "minikube" ...
   â—  This container is having trouble accessing https://registry.cn-hangzhou.aliyuncs.com/google_containers
   ğŸ’¡  To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/
   ğŸ³  æ­£åœ¨ Docker 19.03.2 ä¸­å‡†å¤‡ Kubernetes v1.18.3â€¦
   ğŸ”  Verifying Kubernetes components...
   ğŸŒŸ  Enabled addons: default-storageclass, storage-provisioner
   ğŸ„  å®Œæˆï¼kubectl å·²ç»é…ç½®è‡³ "minikube"
   ```
   æœ‰å…³ä½¿ç”¨ç‰¹å®š Kubernetes ç‰ˆæœ¬ã€VM æˆ–å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨é›†ç¾¤çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[å¯åŠ¨é›†ç¾¤](https://kubernetes.io/zh/docs/setup/learning-environment/minikube/#starting-a-cluster)ã€‚
2. ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl ä¸é›†ç¾¤è¿›è¡Œäº¤äº’ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[ä¸é›†ç¾¤äº¤äº’](https://kubernetes.io/zh/docs/setup/learning-environment/minikube/#interacting-with-your-cluster)ã€‚
   è®©æˆ‘ä»¬ä½¿ç”¨åä¸º echoserver çš„é•œåƒåˆ›å»ºä¸€ä¸ª Kubernetes Deploymentï¼Œå¹¶ä½¿ç”¨ --port åœ¨ç«¯å£ 8080 ä¸Šæš´éœ²æœåŠ¡ã€‚echoserver æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚
   ```
   kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.10
   ```
   è¾“å‡ºç±»ä¼¼äºï¼š
   ```
   deployment.apps/hello-minikube created
   ```
3. è¦è®¿é—® hello-minikube Deploymentï¼Œéœ€è¦å°†å…¶ä½œä¸º Service å…¬å¼€ï¼š
   ```
   kubectl expose deployment hello-minikube --type=NodePort --port=8080
   ```
   é€‰é¡¹ --type = NodePort æŒ‡å®š Service çš„ç±»å‹ã€‚è¾“å‡ºç±»ä¼¼äºï¼š
   ```
   service/hello-minikube exposed
   ```
4. ç°åœ¨ hello-minikube Pod å·²ç»å¯åŠ¨ï¼Œä½†æ˜¯ä½ å¿…é¡»ç­‰åˆ° Pod å¯åŠ¨å®Œå…¨æ‰èƒ½é€šè¿‡æš´éœ²çš„ Service è®¿é—®å®ƒã€‚
   æ£€æŸ¥ Pod æ˜¯å¦å¯åŠ¨å¹¶è¿è¡Œï¼š
   ```
   kubectl get pod
   ```
   å¦‚æœè¾“å‡ºæ˜¾ç¤º STATUS ä¸º ContainerCreatingï¼Œåˆ™è¡¨æ˜ Pod ä»åœ¨åˆ›å»ºä¸­ï¼š
   ```
   AME                              READY     STATUS              RESTARTS   AGE
   hello-minikube-3383150820-vctvh  0/1       ContainerCreating   0          3s
   ```
   å¦‚æœè¾“å‡ºæ˜¾ç¤º STATUS ä¸º Runningï¼Œåˆ™ Pod ç°åœ¨æ­£åœ¨è¿è¡Œï¼š
   ```
   NAME                              READY     STATUS    RESTARTS   AGE
   hello-minikube-3383150820-vctvh   1/1       Running   0          13s
   ```
5. è·å–æš´éœ² Service çš„ URL ä»¥æŸ¥çœ‹ Service çš„è¯¦ç»†ä¿¡æ¯ï¼š
   ```
   minikube service hello-minikube --url
   ```
   è¾“å‡ºç±»ä¼¼äº:
   ```
   http://172.17.0.2:31248
   ```
6. è¦æŸ¥çœ‹æœ¬åœ°é›†ç¾¤çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­å¤åˆ¶ç²˜è´´å¹¶è®¿é—®ä¸Šä¸€æ­¥éª¤è¾“å‡ºçš„ URLã€‚
   è¾“å‡ºç±»ä¼¼äºï¼š
   ```
    Hostname: hello-minikube-7758cdc499-shll4

    Pod Information:
      -no pod information available-

    Server values:
      server_version=nginx: 1.13.3 - lua: 10008

    Request Information:
      client_address=172.18.0.1
      method=GET
      real path=/
      query=
      request_version=1.1
      request_scheme=http
      request_uri=http://172.17.0.2:8080/

    Request Headers:
      accept=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
      accept-encoding=gzip, deflate
      accept-language=zh-CN,zh;q=0.9
      connection=keep-alive
      host=172.17.0.2:31248
      upgrade-insecure-requests=1
      user-agent=Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36

    Request Body:
      -no body in request-
   ```
   å¦‚æœä½ ä¸å†å¸Œæœ›è¿è¡Œ Service å’Œé›†ç¾¤ï¼Œåˆ™å¯ä»¥åˆ é™¤å®ƒä»¬ã€‚
7. åˆ é™¤ hello-minikube Serviceï¼š
   ```
   kubectl delete services hello-minikube
   ```
   è¾“å‡ºç±»ä¼¼äºï¼š
   ```
   service "hello-minikube" deleted
   ```
8. åˆ é™¤ hello-minikube Deploymentï¼š
   ```
   kubectl delete deployment hello-minikube
   ```
   è¾“å‡ºç±»ä¼¼äºï¼š
   ```
   deployment.extensions "hello-minikube" deleted
   ```
9.  åœæ­¢æœ¬åœ° Minikube é›†ç¾¤ï¼š
    ```
    minikube stop
    ```
    è¾“å‡ºç±»ä¼¼äºï¼š
    ```
    Stopping "minikube"...
    "minikube" stopped.
    ```
    æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[åœæ­¢é›†ç¾¤](https://kubernetes.io/zh/docs/setup/learning-environment/minikube/#stopping-a-cluster)ã€‚
10. åˆ é™¤æœ¬åœ° Minikube é›†ç¾¤ï¼š
    ```
    minikube delete
    ```
    è¾“å‡ºç±»ä¼¼äºï¼š
    ```
    Deleting "minikube" ...
    The "minikube" cluster has been deleted.
    ```
    æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[åˆ é™¤é›†ç¾¤](https://kubernetes.io/zh/docs/setup/learning-environment/minikube/#deletion-a-cluster)ã€‚
#### 2.1.4 ç®¡ç†ä½ çš„é›†ç¾¤
##### 2.1.4.1 å¯åŠ¨é›†ç¾¤
minikube start å‘½ä»¤å¯ç”¨äºå¯åŠ¨é›†ç¾¤ã€‚

æ­¤å‘½ä»¤å°†åˆ›å»ºå¹¶é…ç½®ä¸€å°è™šæ‹Ÿæœºï¼Œä½¿å…¶è¿è¡Œå•èŠ‚ç‚¹ Kubernetes é›†ç¾¤ã€‚

æ­¤å‘½ä»¤è¿˜ä¼šé…ç½®ä½ çš„ [kubectl](https://kubernetes.io/zh/docs/reference/kubectl/overview/) å®‰è£…ï¼Œä»¥ä¾¿ä½¿å…¶èƒ½ä¸ä½ çš„ Kubernetes é›†ç¾¤æ­£ç¡®é€šä¿¡ã€‚
> **è¯´æ˜**ï¼šå¦‚æœä½ å¯ç”¨äº† web ä»£ç†ï¼Œåˆ™éœ€è¦å°†æ­¤ä¿¡æ¯ä¼ é€’ç»™ minikube start å‘½ä»¤ï¼š
> https_proxy=<my proxy> minikube start --docker-env http_proxy=<my proxy> --docker-env https_proxy=<my proxy> --docker-env no_proxy=192.168.99.0/24
> 
> ä¸å¹¸çš„æ˜¯ï¼Œå•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ä¸èµ·ä½œç”¨ã€‚Minikube è¿˜åˆ›å»ºäº†ä¸€ä¸ª minikube ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º kubectl çš„é»˜è®¤ä¸Šä¸‹æ–‡ã€‚è¦åˆ‡æ¢å›æ­¤ä¸Šä¸‹æ–‡ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼škubectl config use-context minikubeã€‚
###### æŒ‡å®š Kubernetes ç‰ˆæœ¬
ä½ å¯ä»¥é€šè¿‡å°† --kubernetes-version å­—ç¬¦ä¸²æ·»åŠ åˆ° minikube start å‘½ä»¤æ¥æŒ‡å®šè¦ç”¨äº Minikube çš„ Kubernetes ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œè¦è¿è¡Œç‰ˆæœ¬ v1.19.0ï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```
minikube start --kubernetes-version v1.19.0
```
###### æŒ‡å®š VM é©±åŠ¨ç¨‹åº
ä½ å¯ä»¥é€šè¿‡å°† --vm-driver=<enter_driver_name> å‚æ•°æ·»åŠ åˆ° minikube start æ¥æ›´æ”¹ VM é©±åŠ¨ç¨‹åºã€‚

ä¾‹å¦‚å‘½ä»¤ï¼š
```
minikube start --vm-driver=<driver_name>
```
Minikube æ”¯æŒä»¥ä¸‹é©±åŠ¨ç¨‹åºï¼š
> **è¯´æ˜**ï¼š æœ‰å…³æ”¯æŒçš„é©±åŠ¨ç¨‹åºä»¥åŠå¦‚ä½•å®‰è£…æ’ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[é©±åŠ¨ç¨‹åº](https://minikube.sigs.k8s.io/docs/drivers/)ã€‚

- virtualbox
- vmwarefusion
- kvm2 ([é©±åŠ¨å®‰è£…](https://minikube.sigs.k8s.io/docs/drivers/#kvm2-driver))
- hyperkit ([é©±åŠ¨å®‰è£…](https://minikube.sigs.k8s.io/docs/drivers/#hyperkit-driver))
- hyperv ([é©±åŠ¨å®‰è£…](https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#hyperv-driver))

è¯·æ³¨æ„ï¼Œä¸‹é¢çš„ IP æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥æ›´æ”¹ã€‚å¯ä»¥ä½¿ç”¨ minikube ip æ£€ç´¢ã€‚
- vmware ([é©±åŠ¨å®‰è£…](https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#vmware-unified-driver)) ï¼ˆVMware ç»Ÿä¸€é©±åŠ¨ï¼‰
- none (åœ¨ä¸»æœºä¸Šè¿è¡ŒKubernetesç»„ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ VM ä¸­ã€‚ä½¿ç”¨è¯¥é©±åŠ¨ä¾èµ– Docker ([å®‰è£… Docker](https://docs.docker.com/install/linux/docker-ce/ubuntu/)) å’Œ Linux ç¯å¢ƒ)
###### é€šè¿‡åˆ«çš„å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨é›†ç¾¤
ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨ Minikubeã€‚

è¦ä½¿ç”¨ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œè¯·è¿è¡Œï¼š
```
minikube start \
    --network-plugin=cni \
    --enable-default-cni \
    --container-runtime=containerd \
    --bootstrapper=kubeadm
```
æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ‰©å±•ç‰ˆæœ¬ï¼š
```
minikube start \
    --network-plugin=cni \
    --enable-default-cni \
    --extra-config=kubelet.container-runtime=remote \
    --extra-config=kubelet.container-runtime-endpoint=unix:///run/containerd/containerd.sock \
    --extra-config=kubelet.image-service-endpoint=unix:///run/containerd/containerd.sock \
    --bootstrapper=kubeadm
```

è¦ä½¿ç”¨ CRI-O ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œè¯·è¿è¡Œï¼š
```
minikube start \
    --network-plugin=cni \
    --enable-default-cni \
    --container-runtime=cri-o \
    --bootstrapper=kubeadm
```
æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ‰©å±•ç‰ˆæœ¬ï¼š
```
minikube start \
    --network-plugin=cni \
    --enable-default-cni \
    --extra-config=kubelet.container-runtime=remote \
    --extra-config=kubelet.container-runtime-endpoint=/var/run/crio.sock \
    --extra-config=kubelet.image-service-endpoint=/var/run/crio.sock \
    --bootstrapper=kubeadm
```
###### é€šè¿‡é‡ç”¨ Docker å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨æœ¬åœ°é•œåƒ
å½“ä¸º Kubernetes ä½¿ç”¨å•ä¸ª VM æ—¶ï¼Œé‡ç”¨ Minikube çš„å†…ç½® Docker å®ˆæŠ¤ç¨‹åºéå¸¸æœ‰ç”¨ã€‚é‡ç”¨å†…ç½®å®ˆæŠ¤ç¨‹åºæ„å‘³ç€ä½ ä¸å¿…åœ¨ä¸»æœºä¸Šæ„å»º Docker é•œåƒä»“åº“å¹¶å°†é•œåƒæ¨å…¥å…¶ä¸­ã€‚ç›¸åï¼Œä½ å¯ä»¥åœ¨ä¸ Minikube ç›¸åŒçš„ Docker å®ˆæŠ¤è¿›ç¨‹å†…éƒ¨æ„å»ºï¼Œè¿™å¯ä»¥åŠ é€Ÿæœ¬åœ°å®éªŒã€‚
> **è¯´æ˜**ï¼š ä¸€å®šè¦ç”¨é latest çš„æ ‡ç­¾æ¥æ ‡è®°ä½ çš„ Docker é•œåƒï¼Œå¹¶ä½¿ç”¨è¯¥æ ‡ç­¾æ¥æ‹‰å–é•œåƒã€‚å› ä¸º :latest æ ‡è®°çš„é•œåƒï¼Œå…¶é»˜è®¤é•œåƒæ‹‰å–ç­–ç•¥æ˜¯ Alwaysï¼Œå¦‚æœåœ¨é»˜è®¤çš„ Docker é•œåƒä»“åº“ï¼ˆé€šå¸¸æ˜¯ DockerHubï¼‰ä¸­æ²¡æœ‰æ‰¾åˆ°ä½ çš„ Docker é•œåƒï¼Œæœ€ç»ˆä¼šå¯¼è‡´ä¸€ä¸ªé•œåƒæ‹‰å–é”™è¯¯ï¼ˆErrImagePullï¼‰ã€‚

è¦åœ¨ Mac/Linux ä¸»æœºä¸Šä½¿ç”¨ Docker å®ˆæŠ¤ç¨‹åºï¼Œè¯·åœ¨ shell ä¸­è¿è¡Œ docker-env commandï¼š
```
eval $(minikube docker-env)
```
ä½ ç°åœ¨å¯ä»¥åœ¨ Mac/Linux æœºå™¨çš„å‘½ä»¤è¡Œä¸­ä½¿ç”¨ Docker ä¸ Minikube VM å†…çš„ Docker å®ˆæŠ¤ç¨‹åºè¿›è¡Œé€šä¿¡ï¼š
```
docker ps
```
åœ¨ Centos 7 ä¸Šï¼ŒDocker å¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š
```
Could not read CA certificate "/etc/docker/ca.pem": open /etc/docker/ca.pem: no such file or directory
```
ä½ å¯ä»¥é€šè¿‡æ›´æ–° /etc/sysconfig/docker æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä»¥ç¡®ä¿ Minikube çš„ç¯å¢ƒæ›´æ”¹å¾—åˆ°éµå®ˆï¼š
```
< DOCKER_CERT_PATH=/etc/docker
---
> if [ -z "${DOCKER_CERT_PATH}" ]; then
>   DOCKER_CERT_PATH=/etc/docker
> fi
```
###### é…ç½® Kubernetes
Minikube æœ‰ä¸€ä¸ª "configurator" åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ä»»æ„å€¼é…ç½® Kubernetes ç»„ä»¶ã€‚

è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ `minikube start` å‘½ä»¤ä¸­ä½¿ç”¨ `--extra-config` å‚æ•°ã€‚

æ­¤å‚æ•°å…è®¸é‡å¤ï¼Œå› æ­¤ä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªä¸åŒçš„å€¼å¤šæ¬¡ä¼ é€’å®ƒä»¥è®¾ç½®å¤šä¸ªé€‰é¡¹ã€‚

æ­¤å‚æ•°é‡‡ç”¨ `component.key=value` å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ `component` æ˜¯ä¸‹é¢åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ`key` æ˜¯é…ç½®é¡¹åç§°ï¼Œ`value` æ˜¯è¦è®¾ç½®çš„å€¼ã€‚

é€šè¿‡æ£€æŸ¥æ¯ä¸ªç»„ä»¶çš„ `Kubernetes componentconfigs` çš„æ–‡æ¡£ï¼Œå¯ä»¥æ‰¾åˆ°æœ‰æ•ˆçš„ `key`ã€‚

ä¸‹é¢æ˜¯æ¯ä¸ªç»„ä»¶æ‰€æ”¯æŒçš„é…ç½®çš„ä»‹ç»æ–‡æ¡£ï¼š
- [kubelet](https://godoc.org/k8s.io/kubernetes/pkg/kubelet/apis/config#KubeletConfiguration)
- [apiserver](https://godoc.org/k8s.io/kubernetes/cmd/kube-apiserver/app/options#ServerRunOptions)
- [proxy](https://godoc.org/k8s.io/kubernetes/pkg/proxy/apis/config#KubeProxyConfiguration)
- [controller-manager](https://godoc.org/k8s.io/kubernetes/pkg/controller/apis/config#KubeControllerManagerConfiguration)
- [etcd](https://godoc.org/github.com/coreos/etcd/etcdserver#ServerConfig)
- [scheduler](https://godoc.org/k8s.io/kubernetes/pkg/scheduler/apis/config#KubeSchedulerConfiguration)

**ä¾‹å­**

è¦åœ¨ Kubelet ä¸Šå°† MaxPods è®¾ç½®æ›´æ”¹ä¸º 5ï¼Œè¯·ä¼ é€’æ­¤å‚æ•°ï¼š`--extra-config=kubelet.MaxPods=5`ã€‚

æ­¤åŠŸèƒ½è¿˜æ”¯æŒåµŒå¥—ç»“æ„ã€‚è¦åœ¨è°ƒåº¦ç¨‹åºä¸Šå°† `LeaderElection.LeaderElect` è®¾ç½®æ›´æ”¹ä¸º `true`ï¼Œè¯·ä¼ é€’æ­¤å‚æ•°ï¼š`--extra-config=scheduler.LeaderElection.LeaderElect=true`ã€‚

è¦å°† `apiserver` çš„ `AuthorizationMode` è®¾ç½®ä¸º `RBAC`ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š`--extra-config=apiserver.authorization-mode=RBAC`ã€‚
##### 2.1.4.2 åœæ­¢é›†ç¾¤
minikube stop å‘½ä»¤å¯ç”¨äºåœæ­¢é›†ç¾¤ã€‚

æ­¤å‘½ä»¤å…³é—­ Minikube è™šæ‹Ÿæœºï¼Œä½†ä¿ç•™æ‰€æœ‰é›†ç¾¤çŠ¶æ€å’Œæ•°æ®ã€‚

å†æ¬¡å¯åŠ¨é›†ç¾¤ä¼šå°†å…¶æ¢å¤åˆ°ä»¥å‰çš„çŠ¶æ€ã€‚
##### 2.1.4.3 åˆ é™¤é›†ç¾¤
minikube delete å‘½ä»¤å¯ç”¨äºåˆ é™¤é›†ç¾¤ã€‚

æ­¤å‘½ä»¤å°†å…³é—­å¹¶åˆ é™¤ Minikube è™šæ‹Ÿæœºï¼Œä¸ä¿ç•™ä»»ä½•æ•°æ®æˆ–çŠ¶æ€ã€‚
#### 2.1.5 ä¸é›†ç¾¤äº¤äº’
##### Kubectl
`minikube start` å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º `minikube` çš„ [kubectl ä¸Šä¸‹æ–‡](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#-em-set-context-em-)ã€‚

æ­¤ä¸Šä¸‹æ–‡åŒ…å«ä¸ `Minikube` é›†ç¾¤é€šä¿¡çš„é…ç½®ã€‚

`Minikube` ä¼šè‡ªåŠ¨å°†æ­¤ä¸Šä¸‹æ–‡è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œä½†å¦‚æœä½ ä»¥åéœ€è¦åˆ‡æ¢å›å®ƒï¼Œè¯·è¿è¡Œï¼š
```
kubectl config use-context minikubeï¼Œ
```
æˆ–è€…åƒè¿™æ ·ï¼Œæ¯ä¸ªå‘½ä»¤éƒ½é™„å¸¦å…¶æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼š`kubectl get pods --context=minikube`ã€‚
##### ä»ªè¡¨ç›˜
è¦è®¿é—® [Kubernetes Dashboard](https://kubernetes.io/zh/docs/tasks/access-application-cluster/web-ui-dashboard/)ï¼Œ è¯·åœ¨å¯åŠ¨ Minikube ååœ¨ shell ä¸­è¿è¡Œæ­¤å‘½ä»¤ä»¥è·å–åœ°å€ï¼š
```
minikube dashboard
```
##### Service
è¦è®¿é—®é€šè¿‡èŠ‚ç‚¹ï¼ˆNodeï¼‰ç«¯å£å…¬å¼€çš„ Serviceï¼Œè¯·åœ¨å¯åŠ¨ Minikube ååœ¨ shell ä¸­è¿è¡Œæ­¤å‘½ä»¤ä»¥è·å–åœ°å€ï¼š
```
minikube service [-n NAMESPACE] [--url] NAME
```
#### 2.1.6 ç½‘ç»œ
Minikube VM é€šè¿‡ host-only IP æš´éœ²ç»™ä¸»æœºç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ `minikube ip` å‘½ä»¤è·å¾—è¯¥ IPã€‚

åœ¨ NodePort ä¸Šï¼Œå¯ä»¥é€šè¿‡è¯¥ IP åœ°å€è®¿é—®ä»»ä½•ç±»å‹ä¸º `NodePort` çš„æœåŠ¡ã€‚

è¦ç¡®å®šæœåŠ¡çš„ NodePortï¼Œå¯ä»¥åƒè¿™æ ·ä½¿ç”¨ `kubectl` å‘½ä»¤ï¼š

kubectl get service $SERVICE --output='jsonpath="{.spec.ports[0].nodePort}"'
#### 2.1.7 æŒä¹…å·ï¼ˆPersistentVolumeï¼‰
Minikube æ”¯æŒ hostPath ç±»å‹çš„ [æŒä¹…å·](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)ã€‚

è¿™äº›æŒä¹…å·ä¼šæ˜ å°„ä¸º Minikube VM å†…çš„ç›®å½•ã€‚

Minikube VM å¼•å¯¼åˆ° tmpfsï¼Œå› æ­¤å¤§å¤šæ•°ç›®å½•ä¸ä¼šåœ¨é‡æ–°å¯åŠ¨ï¼ˆ`minikube stop`ï¼‰ä¹‹åä¿æŒä¸å˜ã€‚

ä½†æ˜¯ï¼ŒMinikube è¢«é…ç½®ä¸ºä¿å­˜å­˜å‚¨åœ¨ä»¥ä¸‹ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š
```
/data
/var/lib/minikube
/var/lib/docker
```
ä¸‹é¢æ˜¯ä¸€ä¸ªæŒä¹…å·é…ç½®ç¤ºä¾‹ï¼Œç”¨äºåœ¨ /data ç›®å½•ä¸­ä¿å­˜æ•°æ®ï¼š
```
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv0001
spec:
  accessModes:
    - ReadWriteOnce
  capacity:
    storage: 5Gi
  hostPath:
    path: /data/pv0001/
```
#### 2.1.8 æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶å¤¹
ä¸€äº›é©±åŠ¨ç¨‹åºå°†åœ¨ VM ä¸­æŒ‚è½½ä¸€ä¸ªä¸»æœºæ–‡ä»¶å¤¹ï¼Œä»¥ä¾¿ä½ å¯ä»¥è½»æ¾åœ°åœ¨ VM å’Œä¸»æœºä¹‹é—´å…±äº«æ–‡ä»¶ã€‚ç›®å‰è¿™äº›éƒ½æ˜¯ä¸å¯é…ç½®çš„ï¼Œå¹¶ä¸”æ ¹æ®ä½ æ­£åœ¨ä½¿ç”¨çš„é©±åŠ¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿçš„ä¸åŒè€Œä¸åŒã€‚
> **è¯´æ˜**ï¼š KVM é©±åŠ¨ç¨‹åºä¸­å°šæœªå®ç°ä¸»æœºæ–‡ä»¶å¤¹å…±äº«ã€‚

é©±åŠ¨|æ“ä½œç³»ç»Ÿ|å®¿ä¸»æœºæ–‡ä»¶å¤¹|VM æ–‡ä»¶å¤¹
--------|--------|--------|--------
VirtualBox|Linux|/home|/hosthome
VirtualBox|macOS|/Users|/Users
VirtualBox|Windows|C://Users|/c/Users
VMware Fusion|macOS|/Users|/Users
Xhyve|macOS|/Users|/Users
#### 2.1.9 ç§æœ‰å®¹å™¨é•œåƒä»“åº“
è¦è®¿é—®ç§æœ‰å®¹å™¨é•œåƒä»“åº“ï¼Œè¯·æŒ‰ç…§[æ­¤é¡µ](https://kubernetes.io/zh/docs/concepts/containers/images/)ä¸Šçš„æ­¥éª¤æ“ä½œã€‚

æˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨ `ImagePullSecrets`ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ Minikube VM ä¸Šé…ç½®è®¿é—®æƒé™ï¼Œå¯ä»¥å°† `.dockercfg` æ”¾åœ¨ `/home/docker` ç›®å½•ä¸­ï¼Œæˆ–å°†config.json æ”¾åœ¨ `/home/docker/.docker` ç›®å½•ã€‚
#### 2.1.10 é™„åŠ ç»„ä»¶
ä¸ºäº†è®© Minikube æ­£ç¡®å¯åŠ¨æˆ–é‡æ–°å¯åŠ¨è‡ªå®šä¹‰æ’ä»¶ï¼Œè¯·å°†ä½ å¸Œæœ›ç”¨ Minikube å¯åŠ¨çš„æ’ä»¶æ”¾åœ¨ ~/.minikube/addons ç›®å½•ä¸­ã€‚æ­¤æ–‡ä»¶å¤¹ä¸­çš„æ’ä»¶å°†è¢«ç§»åŠ¨åˆ° Minikube VM å¹¶åœ¨æ¯æ¬¡ Minikube å¯åŠ¨æˆ–é‡æ–°å¯åŠ¨æ—¶è¢«å¯åŠ¨ã€‚
#### 2.1.11 åŸºäº HTTP ä»£ç†ä½¿ç”¨ Minikube
Minikube åˆ›å»ºäº†ä¸€ä¸ªåŒ…å« Kubernetes å’Œ Docker å®ˆæŠ¤è¿›ç¨‹çš„è™šæ‹Ÿæœºã€‚

å½“ Kubernetes å°è¯•ä½¿ç”¨ Docker è°ƒåº¦å®¹å™¨æ—¶ï¼ŒDocker å®ˆæŠ¤ç¨‹åºå¯èƒ½éœ€è¦è®¿é—®å¤–éƒ¨ç½‘ç»œæ¥æ‹‰å–å®¹å™¨é•œåƒã€‚

å¦‚æœä½ é…ç½®äº† HTTP ä»£ç†ï¼Œåˆ™å¯èƒ½ä¹Ÿéœ€è¦ä¸º Docker è¿›è¡Œä»£ç†è®¾ç½®ã€‚

è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨ minikube start æœŸé—´å°†æ‰€éœ€çš„ç¯å¢ƒå˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¯åŠ¨å‘½ä»¤ã€‚

ä¾‹å¦‚ï¼š
```
minikube start --docker-env http_proxy=http://$YOURPROXY:PORT \
                 --docker-env https_proxy=https://$YOURPROXY:PORT
```
å¦‚æœä½ çš„è™šæ‹Ÿæœºåœ°å€æ˜¯ 192.168.99.100ï¼Œé‚£ä¹ˆä½ çš„ä»£ç†è®¾ç½®å¯èƒ½ä¼šé˜»æ­¢ kubectl ç›´æ¥è®¿é—®å®ƒã€‚

è¦ç»•è¿‡æ­¤ IP åœ°å€çš„ä»£ç†é…ç½®ï¼Œä½ åº”è¯¥ä¿®æ”¹ no_proxy è®¾ç½®ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š
```
export no_proxy=$no_proxy,$(minikube ip)
```
#### 2.1.12 å·²çŸ¥çš„é—®é¢˜
éœ€è¦å¤šä¸ªèŠ‚ç‚¹çš„åŠŸèƒ½æ— æ³•åœ¨ Minikube ä¸­ä½¿ç”¨ã€‚
#### 2.1.13 è®¾è®¡
Minikube ä½¿ç”¨ [libmachine](https://github.com/docker/machine/tree/master/libmachine) é…ç½®è™šæ‹Ÿæœºï¼Œ[kubeadm](https://github.com/kubernetes/kubeadm) é…ç½® Kubernetes é›†ç¾¤ã€‚

æœ‰å…³ Minikube çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[ææ¡ˆ](https://git.k8s.io/community/contributors/design-proposals/cluster-lifecycle/local-cluster-ux.md)ã€‚
#### 2.1.14 å…¶ä»–é“¾æ¥
- ç›®æ ‡å’Œéç›®æ ‡: æœ‰å…³ Minikube é¡¹ç›®çš„ç›®æ ‡å’Œéç›®æ ‡ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„ [roadmap](https://git.k8s.io/minikube/docs/contributors/roadmap.md)ã€‚
- å¼€å‘æŒ‡å—: è¯·æŸ¥é˜… [CONTRIBUTING.md](https://git.k8s.io/minikube/CONTRIBUTING.md) è·å–æœ‰å…³å¦‚ä½•æäº¤ Pull Request çš„æ¦‚è¿°ã€‚
- æ„å»º Minikube: æœ‰å…³å¦‚ä½•ä»æºä»£ç æ„å»º/æµ‹è¯• Minikube çš„è¯´æ˜ï¼Œè¯·å‚é˜…[æ„å»ºæŒ‡å—](https://git.k8s.io/minikube/docs/contributors/build_guide.md)ã€‚
- æ·»åŠ æ–°ä¾èµ–: æœ‰å…³å¦‚ä½•å‘ Minikube æ·»åŠ æ–°ä¾èµ–çš„è¯´æ˜ï¼Œè¯·å‚é˜…æ·»åŠ [ä¾èµ–é¡¹æŒ‡å—](https://minikube.sigs.k8s.io/docs/contrib/building/iso/)ã€‚
- æ·»åŠ æ–°æ’ä»¶: æœ‰å…³å¦‚ä½•ä¸º Minikube æ·»åŠ æ–°æ’ä»¶çš„è¯´æ˜ï¼Œè¯·å‚é˜…[æ·»åŠ æ’ä»¶æŒ‡å—](https://git.k8s.io/minikube/docs/contributors/adding_an_addon.md)ã€‚
- MicroK8s: å¸Œæœ›é¿å…è¿è¡Œè™šæ‹Ÿæœºçš„ Linux ç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨ [MicroK8s](https://microk8s.io/) ä½œä¸ºæ›¿ä»£å“ã€‚
### 2.2 ä½¿ç”¨ Kind å®‰è£… Kubernetes
Kind æ˜¯ä¸€ä¸ªä½¿ç”¨ Docker å®¹å™¨â€œèŠ‚ç‚¹â€è¿è¡Œæœ¬åœ° Kubernetes é›†ç¾¤çš„å·¥å…·ã€‚
#### 2.2.1 å®‰è£…
å‚è§[å®‰è£… Kind](https://kind.sigs.k8s.io/docs/user/quick-start/) ã€‚
## 3. ç”Ÿäº§ç¯å¢ƒ
### 3.1 å®¹å™¨è¿è¡Œæ—¶
Kubernetes ä½¿ç”¨å®¹å™¨è¿è¡Œæ—¶æ¥å®ç°åœ¨ pod ä¸­è¿è¡Œå®¹å™¨ã€‚ è¿™æ˜¯å„ç§è¿è¡Œæ—¶çš„å®‰è£…è¯´æ˜ã€‚
> **æ³¨æ„**ï¼š
> æˆ‘ä»¬å‘ç° `runc` åœ¨è¿è¡Œå®¹å™¨ï¼Œå¤„ç†ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦æ—¶å­˜åœ¨ä¸€ä¸ªæ¼æ´ã€‚ æ¶æ„å®¹å™¨å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´è¦†ç›– `runc` äºŒè¿›åˆ¶æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä»¥æ­¤åœ¨ä¸»æœºç³»ç»Ÿçš„å®¹å™¨ä¸Šè¿è¡Œä»»æ„çš„å‘½ä»¤ã€‚
>
> è¯·å‚è€ƒæ­¤é“¾æ¥ä»¥è·å–æœ‰å…³æ­¤é—®é¢˜çš„æ›´å¤šä¿¡æ¯ [cve-2019-5736: runc vulnerability](https://access.redhat.com/security/cve/cve-2019-5736)
#### 3.1.1 é€‚ç”¨æ€§
> **è¯´æ˜**ï¼š æœ¬æ–‡æ¡£æ˜¯ä¸ºåœ¨ Linux ä¸Šå®‰è£… CRI çš„ç”¨æˆ·ç¼–å†™çš„ã€‚ å¯¹äºå…¶ä»–æ“ä½œç³»ç»Ÿï¼Œè¯·æŸ¥æ‰¾ç‰¹å®šäºä½ å¹³å°çš„æ–‡æ¡£ã€‚

ä½ åº”è¯¥ä»¥ root èº«ä»½æ‰§è¡Œæœ¬æŒ‡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨ sudo å‰ç¼€å‘½ä»¤ï¼Œæˆ–è€…æˆä¸º root å¹¶ä»¥è¯¥ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ã€‚
#### 3.1.2 Cgroup é©±åŠ¨ç¨‹åº
å½“æŸä¸ª Linux ç³»ç»Ÿå‘è¡Œç‰ˆä½¿ç”¨ systemd ä½œä¸ºå…¶åˆå§‹åŒ–ç³»ç»Ÿæ—¶ï¼Œåˆå§‹åŒ–è¿›ç¨‹ä¼šç”Ÿæˆå¹¶ä½¿ç”¨ä¸€ä¸ª root æ§åˆ¶ç»„ ï¼ˆcgroupï¼‰ï¼Œå¹¶å……å½“ cgroup ç®¡ç†å™¨ã€‚ systemd ä¸ cgroup é›†æˆç´§å¯†ï¼Œå¹¶å°†ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é… cgroupã€‚ ä½ ä¹Ÿå¯ä»¥é…ç½®å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ cgroupfsã€‚ è¿åŒ systemd ä¸€èµ·ä½¿ç”¨ cgroupfs æ„å‘³ç€å°†æœ‰ä¸¤ä¸ªä¸åŒçš„ cgroup ç®¡ç†å™¨ã€‚

æ§åˆ¶ç»„ç”¨æ¥çº¦æŸåˆ†é…ç»™è¿›ç¨‹çš„èµ„æºã€‚ å•ä¸ª cgroup ç®¡ç†å™¨å°†ç®€åŒ–åˆ†é…èµ„æºçš„è§†å›¾ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹å°†å¯¹å¯ç”¨èµ„æºå’Œä½¿ç”¨ä¸­çš„èµ„æºå…·æœ‰æ›´ä¸€è‡´çš„è§†å›¾ã€‚ å½“æœ‰ä¸¤ä¸ªç®¡ç†å™¨æ—¶ï¼Œæœ€ç»ˆå°†å¯¹è¿™äº›èµ„æºäº§ç”Ÿä¸¤ç§è§†å›¾ã€‚ åœ¨æ­¤é¢†åŸŸæˆ‘ä»¬å·²ç»çœ‹åˆ°æ¡ˆä¾‹ï¼ŒæŸäº›èŠ‚ç‚¹é…ç½®è®© kubelet å’Œ docker ä½¿ç”¨ cgroupfsï¼Œè€ŒèŠ‚ç‚¹ä¸Šè¿è¡Œçš„å…¶ä½™è¿›ç¨‹åˆ™ä½¿ç”¨ systemdï¼›è¿™ç±»èŠ‚ç‚¹åœ¨èµ„æºå‹åŠ›ä¸‹ä¼šå˜å¾—ä¸ç¨³å®šã€‚

æ›´æ”¹è®¾ç½®ï¼Œä»¤å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ `systemd` ä½œä¸º `cgroup` é©±åŠ¨ï¼Œä»¥æ­¤ä½¿ç³»ç»Ÿæ›´ä¸ºç¨³å®šã€‚ è¯·æ³¨æ„åœ¨ `docker `ä¸‹è®¾ç½® `native.cgroupdriver=systemd` é€‰é¡¹ã€‚

> **æ³¨æ„**ï¼š
> å¼ºçƒˆå»ºè®®ä¸è¦æ›´æ”¹å·²åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹çš„ cgroup é©±åŠ¨ã€‚ å¦‚æœ kubelet å·²ç»ä½¿ç”¨æŸ cgroup é©±åŠ¨çš„è¯­ä¹‰åˆ›å»ºäº† podï¼Œå°è¯•æ›´æ”¹è¿è¡Œæ—¶ä»¥ä½¿ç”¨åˆ«çš„ cgroup é©±åŠ¨ï¼Œä¸ºç°æœ‰ Pods é‡æ–°åˆ›å»º PodSandbox æ—¶ä¼šäº§ç”Ÿé”™è¯¯ã€‚ é‡å¯ kubelet ä¹Ÿå¯èƒ½æ— æ³•è§£å†³æ­¤ç±»é—®é¢˜ã€‚ æ¨èå°†å·¥ä½œè´Ÿè½½é€å‡ºèŠ‚ç‚¹ï¼Œä¹‹åå°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­åˆ é™¤å¹¶é‡æ–°åŠ å…¥ã€‚
#### 3.1.3 Docker
åœ¨ä½ çš„æ¯å°æœºå™¨ä¸Šå®‰è£… Dockerã€‚ æ¨èå®‰è£… 19.03.11 ç‰ˆæœ¬ï¼Œä½†æ˜¯ 1.13.1ã€17.03ã€17.06ã€17.09ã€18.06 å’Œ 18.09 ç‰ˆæœ¬ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ è¯·è·Ÿè¸ª Kubernetes å‘è¡Œè¯´æ˜ä¸­ç»è¿‡éªŒè¯çš„ Docker æœ€æ–°ç‰ˆæœ¬å˜åŒ–ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ä½ çš„ç³»ç»Ÿä¸Šå®‰è£… Dockerï¼š
##### Ubuntu 16.06+
```
# å®‰è£… Docker CE
## è®¾ç½®ä»“åº“
### å®‰è£…è½¯ä»¶åŒ…ä»¥å…è®¸ apt é€šè¿‡ HTTPS ä½¿ç”¨å­˜å‚¨åº“
apt-get update && apt-get install \
  apt-transport-https ca-certificates curl software-properties-common
### æ–°å¢ Docker çš„ å®˜æ–¹ GPG ç§˜é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
### æ·»åŠ  Docker apt ä»“åº“
add-apt-repository \
  "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) \
  stable"
## å®‰è£… Docker CE
apt-get update && apt-get install -y\
  containerd.io=1.2.13-2 \
  docker-ce=5:19.03.11~3-0~ubuntu-$(lsb_release -cs) \
  docker-ce-cli=5:19.03.11~3-0~ubuntu-$(lsb_release -cs)
# è®¾ç½® daemon
cat > /etc/docker/daemon.json <<EOF
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2"
}
EOF
mkdir -p /etc/systemd/system/docker.service.d
# é‡å¯ docker.
systemctl daemon-reload
systemctl restart docker
å¦‚æœä½ æƒ³å¼€æœºå³å¯åŠ¨ docker æœåŠ¡ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

sudo systemctl enable docker
```
##### CentOS/RHEL 7.4+
```
# å®‰è£… Docker CE
## è®¾ç½®ä»“åº“
### å®‰è£…æ‰€éœ€åŒ…
yum install yum-utils device-mapper-persistent-data lvm2
### æ–°å¢ Docker ä»“åº“ã€‚
yum-config-manager \
  --add-repo \
  https://download.docker.com/linux/centos/docker-ce.repo
## å®‰è£… Docker CE.
yum update -y && yum install -y \
  containerd.io-1.2.13 \
  docker-ce-19.03.11 \
  docker-ce-cli-19.03.11
## åˆ›å»º /etc/docker ç›®å½•ã€‚
mkdir /etc/docker
# è®¾ç½® daemonã€‚
cat > /etc/docker/daemon.json <<EOF
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2",
  "storage-opts": [
    "overlay2.override_kernel_check=true"
  ]
}
EOF
mkdir -p /etc/systemd/system/docker.service.d
# é‡å¯ Docker
systemctl daemon-reload
systemctl restart docker
å¦‚æœä½ æƒ³å¼€æœºå³å¯åŠ¨ docker æœåŠ¡ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

sudo systemctl enable docker
```

è¯·å‚é˜…å®˜æ–¹ [Docker å®‰è£…æŒ‡å—](https://docs.docker.com/engine/installation/) æ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚
#### 3.1.4 CRI-O
æœ¬èŠ‚åŒ…å«å®‰è£… CRI-O ä½œä¸º CRI è¿è¡Œæ—¶çš„å¿…è¦æ­¥éª¤ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç³»ç»Ÿä¸­å®‰è£… CRI-Oï¼š
##### 3.1.4.1 å‡†å¤‡ç¯å¢ƒ
```
modprobe overlay
modprobe br_netfilter

# è®¾ç½®å¿…éœ€çš„sysctlå‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚
cat > /etc/sysctl.d/99-kubernetes-cri.conf <<EOF
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF

sysctl --system
```
###### Ubuntu 19.04+
# é…ç½®ä»“åº“
```
. /etc/os-release
sudo sh -c "echo 'deb http://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/x${NAME}_${VERSION_ID}/ /' > /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list"
wget -nv https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable/x${NAME}_${VERSION_ID}/Release.key -O- | sudo apt-key add -
sudo apt-get update
```
```
# å®‰è£… CRI-O
sudo apt-get update
sudo apt-get install cri-o-1.17
```
###### CentOS
è¦åœ¨ä»¥ä¸‹æ“ä½œç³»ç»Ÿä¸Šå®‰è£…ï¼Œè¯·å°†ç¯å¢ƒå˜é‡ $OS è®¾ç½®ä¸ºä¸‹è¡¨ä¸­çš„ç›¸åº”å­—æ®µï¼š

æ“ä½œç³»ç»Ÿ	$OS	Centos 8	CentOS_8	Centos 8 Stream	CentOS_8_Stream	Centos 7	CentOS_7

ç„¶åå°† $VERSION è®¾ç½®ä¸ºä¸ä½ çš„ Kubernetes ç›¸åŒ¹é…çš„ CRI-O ç‰ˆæœ¬ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¦å®‰è£… CRI-O 1.18ï¼Œè¯·è®¾ç½® VERSION=1.18ã€‚ ä½ ä¹Ÿå¯ä»¥å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚ 1.18.3ï¼Œè¯·è®¾ç½® VERSION=1.18:1.18.3ã€‚

ç¡®ä¿å£°æ˜å˜é‡åï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…
```
curl -L -o /etc/yum.repos.d/devel:kubic:libcontainers:stable.repo https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/$OS/devel:kubic:libcontainers:stable.repo
curl -L -o /etc/yum.repos.d/devel:kubic:libcontainers:stable:cri-o:$VERSION.repo https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable:cri-o:$VERSION/$OS/devel:kubic:libcontainers:stable:cri-o:$VERSION.repo
yum install cri-o
```
##### 3.1.4.2 å¯åŠ¨ CRI-O
```
systemctl start crio
```
è¯·å‚é˜… [CRI-O å®‰è£…æŒ‡å—](https://github.com/kubernetes-sigs/cri-o#getting-started) æ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚
#### 3.1.5 containerd
æœ¬èŠ‚åŒ…å«ä½¿ç”¨ containerd ä½œä¸º CRI è¿è¡Œæ—¶çš„å¿…è¦æ­¥éª¤ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç³»ç»Ÿä¸Šå®‰è£…å®¹å™¨ï¼š
##### 3.1.5.1 å‡†å¤‡ç¯å¢ƒ
```
cat > /etc/modules-load.d/containerd.conf <<EOF
overlay
br_netfilter
EOF

modprobe overlay
modprobe br_netfilter

# è®¾ç½®å¿…éœ€çš„sysctlå‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚
cat > /etc/sysctl.d/99-kubernetes-cri.conf <<EOF
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF

sysctl --system
```
##### 3.1.5.2 å®‰è£… containerd
###### Ubuntu 16.04+
```
# å®‰è£… containerd
## è®¾ç½®ä»“åº“
### å®‰è£…è½¯ä»¶åŒ…ä»¥å…è®¸ apt é€šè¿‡ HTTPS ä½¿ç”¨å­˜å‚¨åº“
apt-get update && apt-get install -y apt-transport-https ca-certificates curl software-properties-common
### å®‰è£… Docker çš„å®˜æ–¹ GPG å¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
### æ–°å¢ Docker apt ä»“åº“ã€‚
add-apt-repository \
    "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) \
    stable"
## å®‰è£… containerd
apt-get update && apt-get install -y containerd.io
# é…ç½® containerd
mkdir -p /etc/containerd
containerd config default > /etc/containerd/config.toml
# é‡å¯ containerd
systemctl restart containerd
```
###### RHEL 7.4+
```
# å®‰è£… containerd
## è®¾ç½®ä»“åº“
### å®‰è£…æ‰€éœ€åŒ…
yum install yum-utils device-mapper-persistent-data lvm2
### æ–°å¢ Docker ä»“åº“
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
## å®‰è£… containerd
yum update && yum install containerd.io
# é…ç½® containerd
mkdir -p /etc/containerd
containerd config default > /etc/containerd/config.toml
# é‡å¯ containerd
systemctl restart containerd
```
##### 3.1.5.3 systemd
ä½¿ç”¨ systemd cgroup é©±åŠ¨ï¼Œåœ¨ /etc/containerd/config.toml ä¸­è®¾ç½®
```
[plugins.cri]
systemd_cgroup = true
```
å½“ä½¿ç”¨ kubeadm æ—¶ï¼Œè¯·æ‰‹åŠ¨é…ç½® [kubelet çš„ cgroup é©±åŠ¨](https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#configure-cgroup-driver-used-by-kubelet-on-master-node)ã€‚
#### 3.1.6 å…¶ä»–çš„ CRI è¿è¡Œæ—¶ï¼šfrakti
è¯·å‚é˜… [Frakti å¿«é€Ÿå¼€å§‹æŒ‡å—](https://github.com/kubernetes/frakti#quickstart) æ¥è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚
### 3.2 äº¤é’¥åŒ™ï¼ˆTurnkeyï¼‰ äº‘è§£å†³æ–¹æ¡ˆ
- [ä½¿ç”¨ IBM Cloud Private åœ¨å¤šä¸ªäº‘ä¸Šè¿è¡Œ Kubernetes](https://kubernetes.io/zh/docs/setup/production-environment/turnkey/icp/)
- [åœ¨ AWS EC2 ä¸Šè¿è¡Œ Kubernetes](https://kubernetes.io/zh/docs/setup/production-environment/turnkey/aws/)
- [åœ¨ Azure ä¸Šè¿è¡Œ Kubernetes](https://kubernetes.io/zh/docs/setup/production-environment/turnkey/azure/)
- [åœ¨ CenturyLink Cloud ä¸Šè¿è¡Œ Kubernetes](https://kubernetes.io/zh/docs/setup/production-environment/turnkey/clc/)
- [åœ¨è…¾è®¯äº‘å®¹å™¨æœåŠ¡ä¸Šè¿è¡Œ Kubernetes](https://kubernetes.io/zh/docs/setup/production-environment/turnkey/tencent/)
- [åœ¨é˜¿é‡Œäº‘ä¸Šè¿è¡Œ Kubernetes](https://kubernetes.io/zh/docs/setup/production-environment/turnkey/alibaba-cloud/)
#### 3.2.1 åœ¨ AWS EC2 ä¸Šè¿è¡Œ Kubernetes
##### 3.2.1.1 å‡†å¤‡å¼€å§‹
åœ¨ AWS ä¸Šåˆ›å»º Kubernetes é›†ç¾¤ï¼Œä½ å°†éœ€è¦ AWS çš„ Access Key ID å’Œ Secret Access Keyã€‚

æ”¯æŒçš„ç”Ÿäº§çº§åˆ«å·¥å…·ï¼š
- [conjure-up](https://kubernetes.io/zh/docs/setup/) æ˜¯ Kubernetes çš„å¼€æºå®‰è£…ç¨‹åºï¼Œå¯åœ¨ Ubuntu ä¸Šåˆ›å»ºä¸åŸç”Ÿ AWS é›†æˆçš„ Kubernetes é›†ç¾¤ã€‚
- [Kubernetes Operations](https://github.com/kubernetes/kops) - ç”Ÿäº§çº§ K8s çš„å®‰è£…ã€å‡çº§å’Œç®¡ç†ã€‚æ”¯æŒåœ¨ AWS è¿è¡Œ Debianã€Ubuntuã€CentOS å’Œ RHELã€‚
- [kube-aws](https://github.com/kubernetes-incubator/kube-aws) ä½¿ç”¨ [Flatcar Linux](https://www.flatcar-linux.org/) èŠ‚ç‚¹åˆ›å»ºå’Œç®¡ç† Kubernetes é›†ç¾¤ï¼Œå®ƒä½¿ç”¨äº† AWS å·¥å…·ï¼šEC2ã€CloudFormation å’Œ Autoscalingã€‚
- [KubeOne](https://github.com/kubermatic/kubeone) æ˜¯ä¸€ä¸ªå¼€æºé›†ç¾¤ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…·ï¼Œå®ƒå¯ç”¨äºåˆ›å»ºï¼Œå‡çº§å’Œç®¡ç†é«˜å¯ç”¨ Kubernetes é›†ç¾¤ã€‚
##### 3.2.1.2 é›†ç¾¤å…¥é—¨
###### å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼škubectlï¼š
é›†ç¾¤å¯åŠ¨è„šæœ¬å°†åœ¨ä½ çš„å·¥ä½œç«™ä¸Šä¸ºä½ æä¾›ä¸€ä¸ª kubernetes ç›®å½•ã€‚ æˆ–è€…ï¼Œä½ å¯ä»¥ä»[æ­¤é¡µé¢](https://github.com/kubernetes/kubernetes/releases)ä¸‹è½½æœ€æ–°çš„ Kubernetes ç‰ˆæœ¬ã€‚

æ¥ä¸‹æ¥ï¼Œå°†é€‚å½“çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤¹æ·»åŠ åˆ°ä½ çš„ PATH ä»¥è®¿é—® kubectlï¼š
```
# macOS
export PATH=<path/to/kubernetes-directory>/platforms/darwin/amd64:$PATH

# Linux
export PATH=<path/to/kubernetes-directory>/platforms/linux/amd64:$PATH
```
æ­¤å·¥å…·çš„æœ€æ–°æ–‡æ¡£é¡µé¢ä½äºæ­¤å¤„ï¼š[kubectl æ‰‹å†Œ](https://kubernetes.io/zh/docs/reference/kubectl/kubectl/)

é»˜è®¤æƒ…å†µä¸‹ï¼Œkubectl å°†ä½¿ç”¨åœ¨é›†ç¾¤å¯åŠ¨æœŸé—´ç”Ÿæˆçš„ kubeconfig æ–‡ä»¶å¯¹ API è¿›è¡Œèº«ä»½éªŒè¯ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯» [kubeconfig æ–‡ä»¶](https://kubernetes.io/zh/docs/tasks/access-application-cluster/configure-access-multiple-clusters/)ã€‚
###### ç¤ºä¾‹
è¯·å‚é˜…ä¸€ä¸ªç®€å•çš„ [nginx ç¤ºä¾‹](https://kubernetes.io/zh/docs/tasks/run-application/run-stateless-application-deployment/)è¯•ç”¨ä½ çš„æ–°é›†ç¾¤ã€‚

â€œGuestbookâ€ åº”ç”¨ç¨‹åºæ˜¯å¦ä¸€ä¸ªå…¥é—¨ Kubernetes çš„æµè¡Œç¤ºä¾‹ï¼š[guestbook ç¤ºä¾‹](https://github.com/kubernetes/examples/tree/master/guestbook/)ã€‚

æœ‰å…³æ›´å®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œè¯·æŸ¥çœ‹[ç¤ºä¾‹ç›®å½•](https://github.com/kubernetes/examples/tree/master/)ã€‚
##### 3.2.1.3 é›†ç¾¤ä¼¸ç¼©
ä¸æ”¯æŒé€šè¿‡ kubectl æ·»åŠ å’Œåˆ é™¤èŠ‚ç‚¹ã€‚ä½ ä»ç„¶å¯ä»¥é€šè¿‡è°ƒæ•´åœ¨å®‰è£…è¿‡ç¨‹ä¸­åˆ›å»ºçš„ [Auto Scaling Group](https://docs.aws.amazon.com/autoscaling/latest/userguide/as-manual-scaling.html) ä¸­çš„ â€œDesiredâ€ å’Œ â€œMaxâ€ å±æ€§æ¥æ‰‹åŠ¨ä¼¸ç¼©èŠ‚ç‚¹æ•°é‡ã€‚
##### 3.2.1.4 é›†ç¾¤æ‹†é™¤ï¼ˆTearing downï¼‰
ç¡®ä¿ä½ ç”¨äºé…ç½®é›†ç¾¤çš„ç¯å¢ƒå˜é‡å·²è¢«å¯¼å‡ºï¼Œç„¶ååœ¨è¿è¡Œå¦‚ä¸‹åœ¨ Kubernetes ç›®å½•çš„è„šæœ¬ï¼š
```
cluster/kube-down.sh
```
##### 3.2.1.5 æ”¯æŒç­‰çº§
IaaS æä¾›å•†|é…ç½®ç®¡ç†|æ“ä½œç³»ç»Ÿ|ç½‘ç»œ|æ–‡æ¡£|ç¬¦åˆç‡|æ”¯æŒç­‰çº§
--------|--------|--------|--------|--------|--------|--------
AWS|kops|Debian|k8s (VPC)|[docs](https://github.com/kubernetes/kops)|N/A|Community (@justinsb)	
AWS|CoreOS|CoreOS|flannel|[docs](https://kubernetes.io/zh/docs/setup/)|N/A|Community	
AWS|Juju|Ubuntu|flannel, calico, canal|[docs](https://kubernetes.io/zh/docs/setup/)|100%|Commercial, Community	
AWS|KubeOne	Ubuntu, CoreOS, CentOS|canal, weavenet|[docs](https://github.com/kubermatic/kubeone)|100%|Commercial, Community
##### 3.2.1.6 è¿›ä¸€æ­¥é˜…è¯»
è¯·å‚é˜… [Kubernetes æ–‡æ¡£](https://kubernetes.io/zh/docs/)äº†è§£æœ‰å…³ç®¡ç†å’Œä½¿ç”¨ Kubernetes é›†ç¾¤çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
#### 3.2.2 åœ¨é˜¿é‡Œäº‘ä¸Šè¿è¡Œ Kubernetes
##### 3.2.2.1 é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡
[é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡](https://www.alibabacloud.com/product/container-service)ä½¿æ‚¨å¯ä»¥åœ¨é˜¿é‡Œäº‘ ECS å®ä¾‹é›†ç¾¤ä¸Šè¿è¡Œå’Œç®¡ç† Docker åº”ç”¨ç¨‹åºã€‚å®ƒæ”¯æŒæµè¡Œçš„å¼€æºå®¹å™¨ç¼–æ’å¼•æ“ï¼šDocker Swarm å’Œ Kubernetesã€‚

ä¸ºäº†ç®€åŒ–é›†ç¾¤çš„éƒ¨ç½²å’Œç®¡ç†ï¼Œè¯·ä½¿ç”¨ [å®¹å™¨æœåŠ¡ Kubernetes ç‰ˆ](https://www.alibabacloud.com/product/kubernetes)ã€‚æ‚¨å¯ä»¥æŒ‰ç…§ [Kubernetes æ¼”ç»ƒ](https://www.alibabacloud.com/help/doc-detail/86737.htm)å¿«é€Ÿå…¥é—¨ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä½¿ç”¨ä¸­æ–‡ä¹¦å†™çš„[å®¹å™¨æœåŠ¡ Kubernetes ç‰ˆæ•™ç¨‹](https://yq.aliyun.com/teams/11/type_blog-cid_200-page_1)ã€‚

è¦ä½¿ç”¨è‡ªå®šä¹‰äºŒè¿›åˆ¶æ–‡ä»¶æˆ–å¼€æºç‰ˆæœ¬çš„ Kubernetesï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜è¿›è¡Œæ“ä½œã€‚
##### 3.2.2.2 è‡ªå®šä¹‰éƒ¨ç½²
[é˜¿é‡Œäº‘ Kubernetes Cloud Provider å®ç°](https://github.com/AliyunContainerService/kubernetes) çš„æºä»£ç æ˜¯å¼€æºçš„ï¼Œå¯åœ¨ GitHub ä¸Šè·å¾—ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸­æ–‡ç‰ˆæœ¬[å¿«é€Ÿéƒ¨ç½² Kubernetes - é˜¿é‡Œäº‘ä¸Šçš„VPCç¯å¢ƒ](https://yq.aliyun.com/articles/66474)å’Œ[è‹±æ–‡ç‰ˆæœ¬](https://www.alibabacloud.com/forum/read-830)ã€‚
### 3.3 ä½¿ç”¨éƒ¨ç½²å·¥å…·å®‰è£… Kubernetes
### 3.4 æœ¬åœ° VMs
### 3.5 Windows Kubernetes
## 4. æœ€ä½³å®è·µ
### 4.1 åˆ›å»ºå¤§å‹é›†ç¾¤
### 4.2 æ ¡éªŒèŠ‚ç‚¹è®¾ç½®
### 4.3 PKI è¯ä¹¦å’Œè¦æ±‚

## Reference
- [å…¥é—¨](https://kubernetes.io/zh/docs/setup/)
- [Getting started](https://kubernetes.io/docs/setup/)